<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
	x:Class="MyCryptocurrency.Views.MainPage"
	xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:conv="clr-namespace:MyCryptocurrency.Converters"
	xmlns:models="clr-namespace:MyCryptocurrency.Models"
	xmlns:vm="clr-namespace:MyCryptocurrency.ViewModels"
	BackgroundColor="{DynamicResource PageBackgroundColor}">
	<ContentPage.Resources>
		<ResourceDictionary>
			<conv:BoolToColorConverter x:Key="BoolToColorConverter" />
		</ResourceDictionary>
	</ContentPage.Resources>
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="auto" />
			<RowDefinition Height="auto" />
			<RowDefinition Height="*" />
		</Grid.RowDefinitions>
		<StackLayout
			Grid.Row="0"
			Margin="10,10,10,10"
			Padding="10">
			<HorizontalStackLayout>
				<Entry
					x:Name="PairEntry1"
					Placeholder="Enter crypto (e.g., BTC)"
					Text="{Binding NewCryptoPair.CurrencyName1, Mode=TwoWay}" />
				<Label
					FontSize="Large"
					Text="/"
					VerticalOptions="Center" />
				<Entry
					x:Name="PairEntry2"
					Placeholder="Enter crypto (e.g., USDT)"
					Text="{Binding NewCryptoPair.CurrencyName2, Mode=TwoWay}" />
			</HorizontalStackLayout>
			<Button
				Command="{Binding AddCryptoPairCommand}"
				Text="Add Pair"
				WidthRequest="200" />
		</StackLayout>

		<ActivityIndicator
			Grid.Row="1"
			IsRunning="{Binding ActivityIndicatorIsRunning}"
			Color="Blue" />
		<ScrollView Grid.Row="1">
			<CollectionView
				x:Name="CryptoPairsCollectionView"
				Margin="10"
				ItemsSource="{Binding CryptoPairs}"
				SelectionMode="None">
				<CollectionView.ItemTemplate>
					<DataTemplate>
						<Frame
							Margin="5"
							Padding="10"
							BackgroundColor="White"
							BorderColor="#4CAF50"
							CornerRadius="10"
							HasShadow="True">
							<Grid>
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="*" />
									<ColumnDefinition Width="Auto" />
									<ColumnDefinition Width="Auto" />
								</Grid.ColumnDefinitions>
								<Grid.RowDefinitions>
									<RowDefinition Height="Auto" />
									<RowDefinition Height="Auto" />
									<RowDefinition Height="Auto" />
									<RowDefinition Height="Auto" />
									<RowDefinition Height="Auto" />
								</Grid.RowDefinitions>

								<!--  Symbol  -->
								<Label
									Grid.Row="0"
									Grid.Column="0"
									FontAttributes="Bold"
									FontSize="18"
									Text="{Binding CurrencyName1}"
									TextColor="#37474F" />
								<VerticalStackLayout
									Grid.Row="1"
									Grid.Column="0"
									Padding="3"
									Spacing="5">

									<HorizontalStackLayout Spacing="54">

										<!--  Obecna Cena  -->
										<Label
											FontSize="14"
											Text="Cena:"
											TextColor="#6B7280" />
										<Label
											Grid.Row="1"
											Grid.Column="1"
											Margin="0,0,20,0"
											FontAttributes="Bold"
											TextColor="{Binding PriceColor}"
											VerticalOptions="Start">
											<Label.Text>
												<MultiBinding StringFormat="{}{0:F5} {1}">
													<Binding Path="CurrentExchangeRate" />
													<Binding Path="CurrencyName2" />
												</MultiBinding>
											</Label.Text>
										</Label>
									</HorizontalStackLayout>
									<HorizontalStackLayout Spacing="32">
										<!--  Last Direction in pair  -->
										<Label
											FontSize="14"
											Text="Kierunek:"
											TextColor="#6B7280" />
										<Label
											Margin="0,0,20,0"
											FontAttributes="Bold"
											Text="{Binding LastOperationPair}"
											TextColor="Black"
											VerticalOptions="Start" />
									</HorizontalStackLayout>
									<HorizontalStackLayout Spacing="10">

										<!--  Change from last transaction and current price  -->
										<Label
											FontSize="14"
											Text="Zmiana ceny:"
											TextColor="#6B7280" />
										<Label
											Margin="0,0,20,0"
											FontAttributes="Bold"
											Text="{Binding DifferenceFromCurrent, StringFormat='{0:F5}'}"
											TextColor="Black"
											VerticalOptions="Start" />

									</HorizontalStackLayout>
									<HorizontalStackLayout Spacing="7">
										<!--  Ostatnia Operacja  -->
										<Label
											FontSize="14"
											Text="Ost. operacja:"
											TextColor="#6B7280" />
										<Label
											Margin="0,0,20,0"
											FontAttributes="Bold"
											TextColor="Black"
											VerticalOptions="Start">
											<Label.Text>
												<MultiBinding StringFormat="{}{0:F5} {1}">
													<Binding Path="LastOperation.Price" />
													<Binding Path="CurrencyName2" />
												</MultiBinding>
											</Label.Text>
										</Label>
									</HorizontalStackLayout>
								</VerticalStackLayout>
								<!--  Przyciski  -->
								<StackLayout
									Grid.RowSpan="3"
									Grid.Column="2"
									Orientation="Vertical"
									Spacing="10"
									VerticalOptions="Center">
									<Button
										BackgroundColor="#2196F3"
										Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ShowDetailsCommand}"
										CommandParameter="{Binding .}"
										CornerRadius="5"
										FontSize="14"
										Text="Szczegóły"
										TextColor="White" />
									<Button
										BackgroundColor="#F44336"
										Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeletePairCommand}"
										CommandParameter="{Binding .}"
										CornerRadius="5"
										FontSize="14"
										Text="Usuń"
										TextColor="White" />
								</StackLayout>
							</Grid>
						</Frame>
					</DataTemplate>
				</CollectionView.ItemTemplate>
			</CollectionView>
		</ScrollView>

	</Grid>
</ContentPage>
